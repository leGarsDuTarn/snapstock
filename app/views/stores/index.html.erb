<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1 class="h3 fw-bold mb-0">Mes Magasins</h1>
    <p class="text-muted small mb-0">Gérez votre parc et vos équipes</p>
  </div>
  <%= link_to new_store_path, class: "btn btn-primary shadow-sm" do %>
    <i class="fa-solid fa-plus me-2"></i>Nouveau
  <% end %>
</div>

<div class="card border-0 shadow-sm mb-4">
  <div class="card-body p-2">
    <%= form_with url: stores_path, method: :get, class: "d-flex align-items-center" do |f| %>
      <div class="flex-grow-1 position-relative">
        <i class="fa-solid fa-magnifying-glass text-muted position-absolute top-50 start-0 translate-middle-y ms-3"></i>
        <%= f.text_field :query,
            value: params[:query],
            class: "form-control border-0 bg-transparent shadow-none ps-5",
            placeholder: "Rechercher un magasin, une ville..." %>
      </div>

      <% if params[:query].present? %>
        <%= link_to stores_path, class: "btn btn-link text-muted text-decoration-none" do %>
          <i class="fa-solid fa-xmark"></i> Effacer
        <% end %>
      <% else %>
        <button type="submit" class="btn btn-light text-primary fw-bold me-1">
          Filtrer
        </button>
      <% end %>
    <% end %>
  </div>
</div>

<% if @stores.any? %>
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <% @stores.each do |store| %>
      <div class="col">
        <%# Le lien englobe toute la carte pour faciliter le clic sur mobile %>
        <%= link_to store_path(store), class: "text-decoration-none" do %>
          <div class="card h-100 border-0 shadow-sm hover-card">
            <div class="card-body">

              <%# En-tête de la carte : Badge Enseigne %>
              <div class="d-flex justify-content-between align-items-start mb-2">
                <span class="badge bg-primary-subtle text-primary border border-primary-subtle rounded-pill px-3">
                  <%= store.brand.name %>
                </span>
                <i class="fa-solid fa-chevron-right text-muted opacity-50 small"></i>
              </div>

              <%# Corps : Nom et Ville %>
              <h5 class="card-title fw-bold text-dark mb-1 text-truncate">
                <%= store.name %>
              </h5>
              <div class="text-muted small mb-3">
                <i class="fa-solid fa-location-dot me-1 text-secondary"></i>
                <%= store.city %> <span class="text-muted fw-light">(<%= store.zip_code %>)</span>
              </div>

              <%# Footer de carte : Stats rapides %>
              <div class="d-flex align-items-center text-secondary x-small border-top pt-3 mt-auto">
                <div class="me-3" title="Membres de l'équipe">
                  <i class="fa-solid fa-users me-1"></i>
                  <span class="fw-semibold text-dark"><%= store.employees.count + store.managers.count %></span>
                </div>
                <div title="Relevés effectués">
                  <i class="fa-solid fa-clipboard-check me-1"></i>
                  <span class="fw-semibold text-dark"><%= store.inventory_reports.count %></span>
                </div>
              </div>

            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
<% else %>
  <%# État vide (si aucun magasin trouvé) %>
  <div class="text-center py-5">
    <div class="bg-white rounded-circle d-inline-flex align-items-center justify-content-center shadow-sm mb-3" style="width: 80px; height: 80px;">
      <i class="fa-solid fa-shop fa-2x text-muted opacity-50"></i>
    </div>
    <h3 class="h5 fw-bold text-dark">Aucun magasin trouvé</h3>
    <p class="text-muted small">Essayez une autre recherche ou ajoutez un nouveau point de vente.</p>
    <%= link_to "Ajouter un magasin", new_store_path, class: "btn btn-outline-primary btn-sm mt-2" %>
  </div>
<% end %>

